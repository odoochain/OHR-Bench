[
    {
        "text": "ClashEval: Quantifying the tug-of-war between an LLM's internal prior and external evidence\n\n\n\nKevin Wu* \\\\ Department of Biomedical Data Science \\\\ Stanford University \\\\ Stanford, CA 94305 \\\\ kevinywu@stanford.edu\n\n\n\nEric Wu* \\\\ Department of Electrical Engineering \\\\ Stanford University \\\\ Stanford, CA 94305 \\\\ wue@stanford.edu\n\n\n\nJames Zou \\\\ Department of Biomedical Data Science \\\\ Stanford University \\\\ Stanford, CA 94305 \\\\ jamesz@stanford.edu\n\n\n\nRetrieval augmented generation (RAG) is frequently used to mitigate hallucinations and provide up-to-date knowledge for large language models (LLMs). However, given that document retrieval is an imprecise task and sometimes results in erroneous or even harmful content being presented in context, this raises the question of how LLMs handle retrieved information: If the provided content is incorrect, does the model know to ignore it, or does it recapitulate the error? Conversely, when the model's initial response is incorrect, does it always know to use the retrieved information to correct itself, or does it insist on its wrong prior response? To answer this, we curate a dataset of over 1200 questions across six domains (e.g., drug dosages, Olympic records, locations) along with content relevant to answering each question. We further apply precise perturbations to the answers in the content that range from subtle to blatant errors. We benchmark six top-performing LLMs, including GPT-4o, on this dataset and find that LLMs are susceptible to adopting incorrect retrieved content, overriding their own correct prior knowledge over $60 \\%$ of the time. However, the more unrealistic the retrieved content is (i.e. more deviated from truth), the less likely the model is to adopt it. Also, the less confident a model is in its initial response (via measuring token probabilities), the more likely it is to adopt the information in the retrieved content. We exploit this finding and demonstrate simple methods for improving model accuracy where there is conflicting retrieved content. Our results highlight a difficult task and benchmark for LLMs - namely, their ability to correctly discern when it is wrong in light of correct retrieved content and to reject cases when the provided content is incorrect. Our dataset, called ClashEval, and evaluations are open-sourced to allow for future benchmarking on top-performing models at https://github.com/kevinwu23/StanfordClashEval.\n\n\n1 Introduction\n\nLarge language models (LLMs) are prone to hallucinations and incorrect answers [Pal et al., 2023, Sun et al., 2024, Ahmad et al., 2023]. Additionally, they are constrained to knowledge contained in their training corpus and are unable to answer queries about recent events or publicly restricted information. Retrieval augmented generation (RAG) is a commonly used framework that provides",
        "page_idx": 0
    },
    {
        "text": "Figure 1: A schematic of generating modified documents for each dataset. A question is posed to the LLM with and without a reference document containing information relevant to the query. This document is then perturbed to contain modified information and given as context to the LLM. We then observe whether the LLM prefers the modified information or its own prior answer.\nrelevant retrieved content in the LLM prompt and can significantly improve model accuracy [Mao et al., 2020, Chen et al., 2024a, Lewis et al., 2020].\n\nMost commercial LLMs, like ChatGPT [OpenAI, 2023], Gemini [Gemini Team, 2023], and Perplexity.ai, already employ RAG in their Web interfaces. For example, ChatGPT employs a Bing search, whereas Gemini accesses Google Search results. While this can greatly enhance the model's ability to answer questions, it also raises concern for when the retrieved documents or webpages contain incorrect or harmful information [Dash et al., 2023, Daws, 2020, Nastasi et al., 2023]. Indeed, examples of this behavior have already surfaced in widely deployed LLMs. For example, recent headlines showed Google's AI Summary recommending people to \"eat rocks\" or \"put glue on their pizza\" [Hart, 2024, Williams, 2024], presumably due to erroneous or satirical webpages being retrieved. While stricter document filtering or improved retrieval may help reduce this occurrence, it by no means is a cure-all against this problem. At its core, LLMs should not blindly repeat information presented in context but should be able to arbitrate when external information conflicts with its own internal knowledge. While the aforementioned example is one in which the retrieved document is the source of error, the converse is also a significant problem: when the LLM insists on its own incorrect prior answer despite correct external information.\nSome studies have previously investigated the nature of this tension between a model's internal prior knowledge and contextual information. Longpre et al. [2021] found that LLMs exhibited a strong preference for information in the training data even when facts in the context were substituted with similar but incorrect information. More recently, Xie et al. [2023] showed that models can either be highly susceptible to context or very biased towards its priors depending on how the context is framed. Our study extends these works in two important ways. First, we present a dataset that contains examples not only when the context is wrong and the model is right but the converse (where the context is right but the model is wrong). This is important since a dataset that only measures the LLM's ability to reject wrong context can trivially excel at this task by simply always ignoring the context. Instead, our dataset uniquely tests the LLM's ability to arbitrate between its own parametric knowledge and the contextual information to determine the most accurate response. Second, we elicit a quantitative relationship between the LLM's preference of prior or context and two important variables: (1) the model's confidence in its prior response (via measuring the token probabilities of the initial response), and (2) the degree to which the contextual information provided deviates from the reference answer. Measuring these two dynamics is important for understanding how models transition between choosing the prior and the context and their inherent biases towards their priors or the context.\n\n\nOur contributions\n\n- We introduce ClashEval, a question-answering benchmark dataset of over 1200 questions spanning six domains that include the relevant contextual document for answering each",
        "page_idx": 1
    },
    {
        "text": "question. The answer in each document is perturbed across a range of erroneous values, from subtle to extreme.\n- We benchmark six top-performing LLMs (GPT-4o, GPT-3.5, Llama-3-8b-instruct, Gemini 1.5, Claude Opus, and Claude Sonnet) on this dataset and report three relevant metrics.\n- We provide a systematic analysis of context preference rates across three models on (1) varying degrees of perturbation on the contextual information and (2) the token probabilities of the prior responses.\n- We propose a simple way to improve performance on ClashEval by incorporating token probabilities.\n\n\n2 Related Works\n\n\nThe issue of hallucination in LLMs has been explored in multiple contexts and models [Ji et al., 2023, Kaddour et al., 2023]. As a response, RAG systems have been shown to reduce hallucination [Shuster et al., 2021, Kang et al., 2023]. Previous works have explored automated RAG evaluation frameworks in various settings [Es et al., 2023a, Hoshi et al., 2023, Saad-Falcon et al., 2023a, Zhang et al., 2024]. For example, some studies use LLMs to evaluate the faithfulness, answer relevance, and context relevance of RAG systems by using GPT-3.5 as an evaluator [Es et al., 2023b, Saad-Falcon et al., 2023b]. In another study, the authors propose metrics such as noise robustness, negative rejection, information integration, and counterfactual robustness [Chen et al., 2024b]. Multiple studies have shown that RAG can mislead LLMs in the presence of complex or misleading search results and that such models can still make mistakes even when given the correct response [Foulds et al., 2024, Shuster et al., 2021]. In relation to understanding model priors, other works have used log probabilities to assess the LLM's confidence in responses [Mitchell et al., 2023, Zhao et al., 2024]. However, so far there has not been a systematic exploration of a model's confidence (via logprobs) and the model's preference for RAG-provided information. Previous work has also focused on ways to address model adherence to incorrect context. For example, Longpre et al. [2021] suggests pretraining on substituted facts to improve future robustness and Xiang et al. [2024] proposes ensembling isolated answers across multiple documents. In this work, we focus on the case where LLMs are available only via inference, and only one document is being used as context.\n\n3 Methods\n\n3.1 Definitions and Metrics\n\nFollowing the notation from Longpre et al. [2021], Xie et al. [2023], we start with a QA instance $x=(q, c)$ where $q$ is the query and $c$ is the context provided to answer the query. A model's prior response is $r(q)$, where the model is asked to answer the question with only its parametric knowledge. A model's contextual response is $r(q \\mid c)$, where its response to the query is conditioned on the provided context.\n\nIn our study, we define the following metrics:\n- Accuracy $=\\operatorname{Pr}[r(q \\mid c)$ is right $\\mid c$ is right or $r(q)$ is right $]$, the probability the model responds correctly given that either the context is right or the prior is right.\n- Prior Bias $=\\operatorname{Pr}[r(q \\mid c)$ is wrong $\\mid c$ is right and $r(q)$ is wrong $]$, the probability the model uses its prior while the context is correct.\n- Context Bias $=\\operatorname{Pr}[r(q \\mid c)$ is wrong $\\mid c$ is wrong and $r(q)$ is right $]$, the probability the model uses the context while the prior is correct.\n\nOur main analysis consists of evaluating the RAG question-answering capabilities of six LLMs when introducing varying levels of perturbations on the RAG documents. For this study, our dataset consists of 1,294 total questions across 6 different domains. We evaluate the following models: GPT-4o, GPT3.5 (gpt-3.5-turbo-0125), Llama-3 (Llama-3-7B-Instruct), Claude Opus, Claude Sonnet, and Gemini 1.5 Flash. For our contextual responses, we use a standard prompt template that is based on RAG prompts used on popular LLM open-source libraries, with over 800k downloads as of March 2024 (LangChain and LlamaIndex). In addition to this standard prompt, we experiment with \"strict\" and \"loose\" prompts, with results in 6 . Full prompts used are provided in our GitHub repository.",
        "page_idx": 2
    },
    {
        "text": "3.2 Dataset\n\n\\begin{tabular}{lrrl}\n  Dataset Name & \\# Questions & \\# Perturbations & Example Question \\\\\n  Drug Dosage & 249 & 10 & What is the maximum daily dosage in mg for extended release oxybutynin in adults with overactive bladder? \\\\\n  News & 238 & 10 & How many points did Paige Bueckers score in the Big East Tournament title game on March 6, 2023? \\\\\n  Wikipedia Dates & 200 & 10 & In which year was the census conducted that reported the population of Lukhi village in Iran as 35, in 8 families? \\\\\n  Sports Records & 191 & 3 & What is the Olympic record for Men's 100 metres in athletics (time)? \\\\\n  Locations & 200 & Which former United States Senator, born in 1955, also shares the surname with other senators at the state level in Wisconsin, Min- nesota, Massachusetts, Puerto Rico, and New York City? \\\\\n \n\\end{tabular}\n\nTable 1: Statistics for each dataset, including number of questions, number of perturbations applied to each question, and an example question.\n\nWe generate questions from six subject domains (summarized in 1. To generate a large set of question-and-answer pairs, we extract a corpus of content webpages and then query GPT-4o to generate a question based on the text, along with the ground truth answer and the excerpt used to generate the question. Additionally, we select six different datasets to cover diverse knowledge domains and difficulties. For example, news articles are included as examples of out-of-distribution questions that cannot be answered properly without context. For each dataset below, we provide the full prompts used to generate questions in our GitHub repository. Generated questions significantly transform the original data and are covered under fair use; full document content may be covered under copyright, but we provide the accompanying code to reproduce the data. As our data is sourced from the Associated Press and Wikipedia, there is no personally identifiable information or offensive content to our knowledge. UpToDate contains drug information and does not contain PHI or offensive content.\n\nDrug Dosages We initially randomly sampled 500 drug information pages from UpToDate.com, a medical reference website widely used by clinicians. To constrain the scope of questions, we specify in the prompt that the answer must be numerical and in milligrams. To filter out generated questions that did not meet the specified criteria (e.g. ambiguous question, incorrect units, etc.), we perform an additional quality control step, where we ask GPT-4o to verify that the generated question fulfills all criteria. After this step, we have 249 question-answer pairs.\n\nSports Records We pulled Olympic records pages from Wikipedia.org across 9 sports: athletics, weightlifting, swimming, archery, track cycling, rowing, shooting, short-track speed skating, and speed skating. Records are extracted in a table format, from which questions are generated for each record entry. In total, after filtering, we extracted 191 unique questions and answers.\n\nNews Top headlines are pulled from the Associated Press RSS feed for dates ranging from 03/15/24 to $03 / 25 / 24$. From an initial corpus of 1486 news articles, we use GPT- 4 o to generate one question per article, instructing it to produce questions for which there is a clear numerical answer. We performed another GPT-4o quality control step, which resulted in 238 unique question-answer pairs.",
        "page_idx": 3
    },
    {
        "text": "\\begin{tabular}{|c|c|c|c|c|c|c|c|}\n  Dataset & Example Question & Answer & Response w/o Context & Modification & Value in document & Response w/ Context & Preferred Context? \\\\\n  \\multirow{5}{*}{Drug Dosages} & \\multirow[t]{5}{*}{What is the maximum daily dosage of olanzapine for the treatment of agitation/aggression associated with psychiatric disorders in adults?} & \\multirow{5}{*}{30} & \\multirow{5}{*}{20} & 0.1 x & 3 & 20 & $\\times$ \\\\\n  & & & & $0.4 x$ & 12 & 20 & $\\times$ \\\\\n  & & & & Reference & 30 & 30 & v \\\\\n  & & & & $1.5 x$ & 45 & 45 & v \\\\\n  & & & & $10 x$ & 300 & 20 & $\\times$ \\\\\n  \\multirow{5}{*}{Sports Records} & \\multirow{5}{*}{What is the Olympic record for Men's 10,000 metres in speed skating (time)?} & \\multirow{5}{*}{49.45} & \\multirow{5}{*}{49.45} & $0.1 x$ & 4.904 & 49.45 & X \\\\\n  & & & & $0.4 x$ & 19.618 & 19.618 & v \\\\\n  & & & & Reference & 49.45 & 49.45 & $\\checkmark$ \\\\\n  & & & & $1.5 x$ & $1: 13.567$ & $1: 13.567$ & v \\\\\n  & & & & 10 x & 8:10.450 & 8:10.450 & $\\checkmark$ \\\\\n  \\multirow{5}{*}{Dates} & \\multirow{5}{*}{In what year did Frank Thompson Jr. become the chairman of the House Administration Committee?} & \\multirow{5}{*}{1976} & \\multirow{5}{*}{1975} & $-77$ & 1899 & 1975 & $\\times$ \\\\\n  & & & & $-11$ & 1965 & 1965 & $\\checkmark$ \\\\\n  & & & & Reference & 1976 & 1976 & v \\\\\n  & & & & 11 & 1987 & 1977 & $\\times$ \\\\\n  & & & & 77 & 2053 & 1975 & $x$ \\\\\n  \\multirow{3}{*}{Names} & \\multirow[b]{3}{*}{Who did Whitney Jones partner with in the doubles draw at the 2007 Sunfeast Open?} & \\multirow{3}{*}{Sandy Gumulya} & \\multirow{3}{*}{Tatiana Poutchek} & Reference & Sandy Gumulya & Sandy Gumulya & v \\\\\n  & & & & Slight & Sandra Gumulya & Sandra Gumulya & v \\\\\n  & & & & Comical & Sandy Bubbleyumya & Sandy Gumulya & $x$ \\\\\n  \\multirow{3}{*}{Locations} & \\multirow[t]{3}{*}{Which city was Ivan Rybovalov born in on November 29, 1981?} & \\multirow{3}{*}{Simferopol} & \\multirow{3}{*}{Kharkiv} & Reference & Simferopol & Simferopol & $\\checkmark$ \\\\\n  & & & & Slight & Sevastopol & Sevastopol & $\\checkmark$ \\\\\n  & & & & Comical & Simpsonsopolis & Simferopol & $\\times$ \\\\\n \n\\end{tabular}\n\nFigure 2: Examples from three datasets demonstrating differential LLM responses across various types of context modifications. Responses in red indicate wrong responses (different than the answer); responses in green indicate correct responses.\n\nDates, Names, and Cities We begin with a random sample of 1000 articles from Huggingface's Wikipedia dataset (20220301.en, [Foundation]). We use GPT-4o to generate questions related to each field (dates, names, and cities) and filter out responses where the excerpt is not exactly found in the context. To reduce ambiguity when matching groundtruth answers, we restrict the answers to fit certain formats. For dates, we require that the answer adheres to a four-digit year (YYYY). For names, we require a first and last name (eg. George Washington). For cities, we remove any other identities (eg. Seattle, not Seattle, WA). For each domain, among the remaining question-answer pairs that fit these criteria, we randomly sample 200 for our evaluation set.\n\n\n3.3 Modifying the Retrieved Documents\n\n\nWe perform systematic perturbations on each question/answer pair (as visualized in Figure 1. In three datasets with numerical answers (Drug Dosages, Sports Records, Latest News), we produce ten modifications that act as multipliers on the original value: $0.1,0.2,0.4,0.8,1.2,1.5,2.0,3.0,5.0,10.0$. In the Wikipedia Years dataset, we perform ten absolute modifications in increments of 20 years for a range of $[-100,100]$. For the Wikipedia Names and Locations, the discrete categories required more hand-crafted levels of variation. For each, we performed three categorical perturbations via prompting: slight, significant, and comical. We provide the full prompts used in our study in our GitHub repository. For example, for a name like Bob Green, a slight modification implies a small tweak to another real name (Rob Greene), whereas a significant modification produces a similar but fictitious name (Bilgorn Grevalle), and a comical modification is an absurd variant (Blob Lawnface). For a city name like Miami, a slight modification changes the name of the most similar city (Fort Lauderdale), a significant modification produces a fictitious city name (Marisole), and a comical modification produces an absurd variant (Miameme). Because of differences in how each modified fact might appear in the retrieved text, we utilize GPT-4o to generate the perturbed excerpts for",
        "page_idx": 4
    },
    {
        "text": "drug dosages and news. Each modified fact is replaced in the original retrieved text. Then, both the question and context are posed to GPT-4, from which the answers, along with the log probabilities of the output tokens, are collected.\n\n\n4 Results\n\n\\begin{tabular}{lllc}\n  Model & Chosen & Prior Correct & Context Correct \\\\\n  \\multirow{3}{*}{ Claude Opus } & Prior & $0.585(0.550,0.619)$ & $0.042(0.027,0.058)$ \\\\\n& Context & $0.313(0.282,0.346)$ & $0.901(0.879,0.923)$ \\\\\n& Neither & $0.102(0.082,0.125)$ & $0.057(0.040,0.075)$ \\\\\n  \\multirow{3}{*}{ Claude Sonnet } & Prior & $0.436(0.403,0.469)$ & $0.051(0.037,0.067)$ \\\\\n& Context & $0.401(0.374,0.434)$ & $0.881(0.859,0.903)$ \\\\\n& Neither & $0.163(0.138,0.186)$ & $0.068(0.052,0.086)$ \\\\\n  \\multirow{3}{*}{ Gemini 1.5 } & Prior & $0.388(0.362,0.416)$ & $0.074(0.058,0.091)$ \\\\\n& Context & $0.490(0.461,0.521)$ & $0.860(0.838,0.881)$ \\\\\n& Neither & $0.122(0.103,0.143)$ & $0.066(0.051,0.082)$ \\\\\n  \\multirow{3}{*}{ GPT-4o } & Prior & $0.327(0.293,0.358)$ & $0.041(0.027,0.056)$ \\\\\n& Context & $0.608(0.571,0.643)$ & $0.903(0.881,0.923)$ \\\\\n& Neither & $0.065(0.047,0.083)$ & $0.056(0.040,0.072)$ \\\\\n  \\multirow{3}{*}{ GPT-3.5 } & Prior & $0.237(0.213,0.263)$ & $0.057(0.043,0.072)$ \\\\\n& Context & $0.626(0.598,0.657)$ & $0.841(0.817,0.865)$ \\\\\n& Neither & $0.137(0.113,0.160)$ & $0.102(0.082,0.123)$ \\\\\n  \\multirow{3}{*}{ Llama-3 } & Prior & $0.208(0.185,0.230)$ & $0.041(0.029,0.054)$ \\\\\n& Context & $0.529(0.499,0.558)$ & $0.793(0.767,0.818)$ \\\\\n& Neither & $0.263(0.236,0.291)$ & $0.166(0.145,0.191)$ \\\\\n \n\\end{tabular}\n\nTable 2: We report model behavior given a subset of the data where either the prior or the context is correct. A model exhibits prior bias by choosing its prior when only the context is correct, while it exhibits context bias by choosing the context when only the prior is correct. We also report when neither the prior nor context answer is used in the model response.\n\n4.1 Prior vs. Context Conflict Resolution\n\nIn Table 2, Table 4, and Figure 5, we report the responses for each of the six models when only the prior is correct or only the context is correct. On one end, models like Llama-3 and GPT-3.5 are at near random accuracy at the task of discerning when to use the prior or context answer. On the other hand, the top performing model on all three metrics is Claude Opus, with an accuracy of $74.3 \\%$, a context bias of $15.7 \\%$, and a prior bias of $2.1 \\%$. Interestingly, while GPT-4o is the current highest performing model on LMSYS Chatbot Area (as of June 2024), it has a higher context bias than all other models but GPT-3.5. While Llama-3 has a lower context bias than GPT-4o, it also has a lower accuracy because it has a higher rate of choosing neither the prior nor the context in its response. Examples of questions and model responses are shown in 2.\n\n4.2 Context Preference Rate vs. Degree of Context Modification\n\nWe consider the degree of deviation between the model's prior response and the value contained in the retrieved context (Figure 3). After fitting a linear model over the data, we find a clear negative correlation between the degree of modification in the context to the context preference rate. Models that perform stronger on ClashEval exhibit both a lower intercept and a more negative slope, indicating higher resistance to incorrect context. For example, Claude Opus adheres to incorrect contextual information $30 \\%$ less than GPT- 4 o for the same degrees of modification. Interestingly, these results suggest that each model has a different prior distribution over truthfulness across each domain.",
        "page_idx": 5
    },
    {
        "text": "Figure 3: We observe an inverse relationship between the context preference rate (y-axis) and the amount of deviation from the prior (x-axis). Each plot visualizes absolute deviation from the reference information (for numerical datasets, up to two log-fold changes (along with the trendline); for \"Years\", the absolute number of years; for categorical datasets, a total of four modification categories) against context preference rate.\n\n\n4.3 Context Preference Rate vs. Prior Token Probability\n\n\nIn Figure 4, we observe a consistent negative relationship between the token probability of the model's prior answer and the associated RAG preference rate for all six QA datasets. To visualize an even distribution across probabilities, we bin the probabilities into ten equidistant bins in the range of $[0.0,1.0]$. The slope indicates the effect of stronger model confidence on the model's preference for the information presented in the retrieved context; we observe different slopes (ranging from - 0.1 to -0.45), suggesting that the effectiveness of RAG in different QA domains can be characterized as being relatively susceptible (e.g., with Dates questions) or robust (e.g., with News questions) to the model's internal prior knowledge confidence. Specifically, a slope of -0.45 , for instance, can be interpreted as expecting a $4.5 \\%$ decrease in the likelihood of the LLM preferring the contextual information for every $10 \\%$ increase in the probability of the model's prior response.\n\n4.3.1 Initial Methods for Improving Prior vs. Context Conflict Resolution\n\nBased on our observations from the relationship between the token probabilities and the rates of preference for context, we posit that comparing token probabilities between $r(q)$ and $r(q \\mid c)$ can improve the abilities of models to resolve conflicts. In Table 3, Token Probability Correction is done by comparing the mean token probabilities of the model's response with and without context. If the probability is higher for the prior than the contextual response, then we use the model's generation without context as its final response. Otherwise, we just use the response with context. We find that this method improves the overall accuracy of all three models with a moderate increase in the prior bias of each model. Next, we observe that the probability distributions between prior responses and context-given responses are uncalibrated, where context-given response probabilities are extremely right-tailed while prior probabilities are nearly uniform. As a simple adjustment, we compare the percentiles rather than raw probability scores of each score, or the Calibrated Token",
        "page_idx": 6
    },
    {
        "text": "Figure 4: We additionally observe an inverse relationship between the context preference rate (yaxis) and the model's prior response probability (x-axis). Context preference rate is defined as the proportion of responses that align with the information presented in the prompt as context. The model's prior response probability is computed from the average log probability of the response tokens queried without context. Each plot visualizes the prior probability (grouped into 10 bins) against the context preference rate, along with the best-fit trend line and slope. Models that allow access to token probabilities are shown.\n\\begin{tabular}{llccc}\n  Model & Correction & Accuracy $\\uparrow$ & Context Bias $\\downarrow$ & Prior Bias $\\downarrow$ \\\\\n  \\multirow{3}{*}{ GPT-4o } & No correction (Baseline) & $0.615(0.595,0.636)$ & $0.304(0.287,0.321)$ & $\\mathbf{0 . 0 2 1}(\\mathbf{0 . 0 1 4 , 0 . 0 2 8 )}$ \\\\\n& Token Probability Correction & $0.693(0.672,0.714)$ & $0.194(0.177,0.210)$ & $0.043(0.032,0.053)$ \\\\\n& Calibrated Token Prob. Correction & $\\mathbf{0 . 7 5 4 ( 0 . 7 3 3 , 0 . 7 7 5 )}$ & $\\mathbf{0 . 1 0 7 ( 0 . 0 9 3 , 0 . 1 2 2 )}$ & $0.085(0.072,0.098)$ \\\\\n  \\multirow{3}{*}{ GPT-3.5 } & No correction (Baseline) & $0.539(0.521,0.557)$ & $0.313(0.298,0.328)$ & $\\mathbf{0 . 0 2 8 ( 0 . 0 2 1 , 0 . 0 3 6 )}$ \\\\\n& Token Probability Correction & $0.596(0.575,0.616)$ & $0.253(0.237,0.269)$ & $0.056(0.046,0.067)$ \\\\\n& Calibrated Token Prob. Correction & $\\mathbf{0 . 7 0 1 ( 0 . 6 7 8 , 0 . 7 2 2 )}$ & $\\mathbf{0 . 1 1 0 ( 0 . 0 9 8 , 0 . 1 2 4 )}$ & $0.147(0.132,0.164)$ \\\\\n  \\multirow{3}{*}{ Llama-3 } & No correction (Baseline) & $0.500(0.483,0.515)$ & $0.264(0.250,0.279)$ & $\\mathbf{0 . 0 2 1}(\\mathbf{0 . 0 1 5 , 0 . 0 2 7 )}$ \\\\\n& Token Probability Correction & $0.556(0.537,0.574)$ & $0.235(0.220,0.249)$ & $0.046(0.037,0.055)$ \\\\\n& Calibrated Token Prob. Correction & $\\mathbf{0 . 6 4 9 ( 0 . 6 2 7 , 0 . 6 6 9})$ & $\\mathbf{0 . 1 1 1 ( 0 . 0 9 9 , 0 . 1 2 2 )}$ & $0.188(0.173,0.204)$ \\\\\n \n\\end{tabular}\n\nTable 3: For models which provide token probabilities, we evaluate the accuracy, context bias, and prior bias under three conditions: (1) No correction, which is the baseline result from this paper, (2) the token probability correction, and (3) the calibrated token probability correction.\n\nProbability Correction. We find that calibrated token probability correction improves all models' overall accuracy by $14 \\%$ and context bias by $20 \\%$. At the same time, this introduces more prior bias, from $2 \\%$ to $8.5 \\%$. However, this method outperforms a baseline of randomly replacing the final response with its prior - at the same bias rate of $8.5 \\%$, the random baseline has an accuracy of $57.5 \\%$ as compared to the $75.4 \\%$ from the method. While this paper focuses on developing the ClashEval benchmark, these results suggest that probability calibration is a promising approach to reduce prior and context bias deserving further investigation. It also is a natural baseline for future methods.",
        "page_idx": 7
    },
    {
        "text": "5 Discussion\n\n\nThe ClashEval benchmark dataset and evaluations provide novel insights into how LLMs arbitrate between their own internal knowledge and contextual information when the two are in conflict.\n\nA key finding is that even the most advanced LLMs like GPT-4o exhibit a strong context bias, overriding their own correct prior knowledge over $60 \\%$ of the time when presented with incorrect information in the retrieved documents. However, this bias is not absolute - the degree to which the retrieved content deviates from truth negatively correlates with the context preference rate. Interestingly, each LLM exhibits a different prior distribution over truthfulness across domains, such that the same perturbation level affects each model differently. For instance, for a given magnitude of deviation, Claude Opus adheres to incorrect contextual information 30\\% less often than GPT-4o. While GPT-4o achieves state-of-the-art results on general-purpose tasks, it exhibits higher context bias compared to smaller models like Claude Sonnet. This finding suggests that performance on knowledge-based benchmarks may not automatically mean it is most suitable for RAG settings. Additionally, we find that LLMs are calibrated to selectively defer to external evidence when they are less certain about a given query. However, each model differs in how well-calibrated they are. While strong priors are not inherently problematic, the lack of explicit expectations around how models will decide to use contextual information remains a risk. We propose a simple method for improving models under ClashEval, and hope that future work can improve upon this baseline.\n\nOur analyses have several key limitations. First, RAG systems can be deployed to many more domains than can be covered by our analyses. Second, to make our experiments tractable, our question-generation process is strictly fact-based and does not require multi-step logic, document synthesis, or other higher-level reasoning. Third, our dataset contains an enriched rate of contextual errors, so the reported metrics are not meant to represent bias rates in the wild. Fourth, our proposed token probability method only applies to models which provide probability outputs. Finally, even though this dataset is intended to improve an LLM's ability to provide users with accurate information, bad actors could use such information to exploit the shortcomings of certain models described in this paper.\nAs retrieval-augmented AI systems become increasingly prevalent, we hope our dataset and insights spur further research into improving the robustness and calibration of such models. Resolving the tension between parametric priors and retrieved information is a crucial challenge on the path to safe and trustworthy language models.\n\nReferences\n\nMuhammad Aurangzeb Ahmad, Ilker Yaramis, and Taposh Dutta Roy. Creating trustworthy LLMs: Dealing with hallucinations in healthcare AI. September 2023.\n\nJiawei Chen, Hongyu Lin, Xianpei Han, and Le Sun. Benchmarking large language models in Retrieval-Augmented generation. AAAI, 38(16):17754-17762, March 2024a.\n\nJiawei Chen, Hongyu Lin, Xianpei Han, and Le Sun. Benchmarking large language models in retrieval-augmented generation. In Proceedings of the AAAI Conference on Artificial Intelligence, volume 38, pages $17754-17762$, 2024b.\n\nDebadutta Dash, Rahul Thapa, Juan M Banda, Akshay Swaminathan, Morgan Cheatham, Mehr Kashyap, Nikesh Kotecha, Jonathan H Chen, Saurabh Gombar, Lance Downing, Rachel Pedreira, Ethan Goh, Angel Arnaout, Garret Kenn Morris, Honor Magon, Matthew P Lungren, Eric Horvitz, and Nigam H Shah. Evaluation of GPT-3.5 and GPT-4 for supporting real-world information needs in healthcare delivery. April 2023.\n\nRyan Daws. Medical chatbot using OpenAI's GPT-3 told a fake patient to kill themselves. https://www.artificialintelligence-news.com/2020/10/28/ medical-chatbot-openai-gpt3-patient-kill-themselves/, October 2020. Accessed: 2024-1-19.",
        "page_idx": 8
    },
    {
        "text": "Shahul Es, Jithin James, Luis Espinosa-Anke, and Steven Schockaert. RAGAS: Automated evaluation of retrieval augmented generation. September 2023a.\n\nShahul Es, Jithin James, Luis Espinosa-Anke, and Steven Schockaert. Ragas: Automated evaluation of retrieval augmented generation. arXiv preprint arXiv:2309.15217, 2023 b.\n\nPhilip Feldman Foulds, R James, and Shimei Pan. Ragged edges: The double-edged sword of retrieval-augmented chatbots. arXiv preprint arXiv:2403.01193, 2024.\n\nWikimedia Foundation. Wikimedia downloads. URL https://dumps.wikimedia.org.\nGemini Team. Gemini: A family of highly capable multimodal models. December 2023.\nRobert Hart. Google restricts ai search tool after \"nonsensical\" answers told people to eat rocks and put glue on pizza, May 2024. URL https://www.forbes.com/sites/roberthart/2024/05/31/ google-restricts-ai-search-tool-after-nonsensical-answers-told-people-to-eat-rocks-and-put-gl ?sh=64183b617f61.\n\nYasuto Hoshi, Daisuke Miyashita, Youyang Ng, Kento Tatsuno, Yasuhiro Morioka, Osamu Torii, and Jun Deguchi. RaLLe: A framework for developing and evaluating Retrieval-Augmented large language models. August 2023.\n\nZiwei Ji, Nayeon Lee, Rita Frieske, Tiezheng Yu, Dan Su, Yan Xu, Etsuko Ishii, Ye Jin Bang, Andrea Madotto, and Pascale Fung. Survey of hallucination in natural language generation. ACM Computing Surveys, 55(12):1-38, 2023.\n\nJean Kaddour, Joshua Harris, Maximilian Mozes, Herbie Bradley, Roberta Raileanu, and Robert McHardy. Challenges and applications of large language models. arXiv preprint arXiv:2307.10169, 2023.\n\nHaoqiang Kang, Juntong Ni, and Huaxiu Yao. Ever: Mitigating hallucination in large language models through real-time verification and rectification. arXiv preprint arXiv:2311.09114, 2023.\n\nPatrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich Küttler, Mike Lewis, Wen-Tau Yih, Tim Rocktäschel, and Others. Retrieval-augmented generation for knowledge-intensive nlp tasks. Adv. Neural Inf. Process. Syst., 33:9459-9474, 2020.\n\nShayne Longpre, Kartik Perisetla, Anthony Chen, Nikhil Ramesh, Chris DuBois, and Sameer Singh. Entity-based knowledge conflicts in question answering. arXiv preprint arXiv:2109.05052, 2021.\n\nYuning Mao, Pengcheng He, Xiaodong Liu, Yelong Shen, Jianfeng Gao, Jiawei Han, and Weizhu Chen. Generation-Augmented retrieval for open-domain question answering. September 2020.\n\nE Mitchell, Yoonho Lee, Alexander Khazatsky, Christopher D Manning, and Chelsea Finn. DetectGPT: Zero-shot machine-generated text detection using probability curvature. ICML, pages 24950-24962, January 2023.\n\nAnthony J Nastasi, Katherine R Courtright, Scott D Halpern, and Gary E Weissman. Does ChatGPT provide appropriate and equitable medical advice?: A vignette-based, clinical evaluation across care contexts. March 2023.\n\nOpenAI. GPT-4 technical report. March 2023.\nAnkit Pal, Logesh Kumar Umapathi, and Malaikannan Sankarasubbu. Med-HALT: Medical domain hallucination test for large language models. July 2023.\n\nJon Saad-Falcon, Omar Khattab, Christopher Potts, and Matei Zaharia. ARES: An automated evaluation framework for Retrieval-Augmented generation systems. November 2023a.\n\nJon Saad-Falcon, Omar Khattab, Christopher Potts, and Matei Zaharia. Ares: An automated evaluation framework for retrieval-augmented generation systems. arXiv preprint arXiv:2311.09476, 2023b.\n\nKurt Shuster, Spencer Poff, Moya Chen, Douwe Kiela, and Jason Weston. Retrieval augmentation reduces hallucination in conversation. arXiv preprint arXiv:2104.07567, 2021.",
        "page_idx": 9
    },
    {
        "text": "Lichao Sun, Yue Huang, Haoran Wang, Siyuan Wu, Qihui Zhang, Chujie Gao, Yixin Huang, Wenhan Lyu, Yixuan Zhang, Xiner Li, Zhengliang Liu, Yixin Liu, Yijue Wang, Zhikun Zhang, Bhavya Kailkhura, Caiming Xiong, Chaowei Xiao, Chunyuan Li, Eric Xing, Furong Huang, Hao Liu, Heng Ji, Hongyi Wang, Huan Zhang, Huaxiu Yao, Manolis Kellis, Marinka Zitnik, Meng Jiang, Mohit Bansal, James Zou, Jian Pei, Jian Liu, Jianfeng Gao, Jiawei Han, Jieyu Zhao, Jiliang Tang, Jindong Wang, John Mitchell, Kai Shu, Kaidi Xu, Kai-Wei Chang, Lifang He, Lifu Huang, Michael Backes, Neil Zhenqiang Gong, Philip S Yu, Pin-Yu Chen, Quanquan Gu, Ran Xu, Rex Ying, Shuiwang Ji, Suman Jana, Tianlong Chen, Tianming Liu, Tianyi Zhou, Willian Wang, Xiang Li, Xiangliang Zhang, Xiao Wang, Xing Xie, Xun Chen, Xuyu Wang, Yan Liu, Yanfang Ye, Yinzhi Cao, Yong Chen, and Yue Zhao. TrustLLM: Trustworthiness in large language models. January 2024.\n\nRhiannon Williams. Why google's AI overviews gets things wrong. MIT Technology Review, May 2024.\n\nChong Xiang, Tong Wu, Zexuan Zhong, David Wagner, Danqi Chen, and Prateek Mittal. Certifiably robust rag against retrieval corruption. arXiv preprint arXiv:2405.15556, 2024.\n\nJian Xie, Kai Zhang, Jiangjie Chen, Renze Lou, and Yu Su. Adaptive chameleon or stubborn sloth: Unraveling the behavior of large language models in knowledge conflicts. arXiv preprint arXiv:2305.13300, 2023.\n\nZihan Zhang, Meng Fang, and Ling Chen. RetrievalQA: Assessing adaptive Retrieval-Augmented generation for short-form Open-Domain question answering. February 2024.\n\nQinyu Zhao, Ming Xu, Kartik Gupta, Akshay Asthana, Liang Zheng, and Stephen Gould. The first to know: How token distributions reveal hidden knowledge in large Vision-Language models? March 2024.\n\n\nA Appendix\n\n\\begin{tabular}{lccc}\n  Model & Context Bias $\\downarrow$ & Prior Bias $\\downarrow$ & Accuracy $\\uparrow$ \\\\\n  Claude Opus & $\\mathbf{0 . 1 5 7}(0.141,0.174)$ & $\\mathbf{0 . 0 2 1}(0.014,0.029)$ & $\\mathbf{0 . 7 4 3}(0.723,0.763)$ \\\\\nClaude Sonnet & $0.201(0.184,0.215)$ & $0.025(0.018,0.033)$ & $0.658(0.641,0.678)$ \\\\\nGemini 1.5 & $0.245(0.231,0.260)$ & $0.037(0.029,0.046)$ & $0.624(0.607,0.641)$ \\\\\nGPT-4o & $0.304(0.287,0.321)$ & $0.021(0.013,0.028)$ & $0.615(0.594,0.633)$ \\\\\nGPT-3.5 & $0.313(0.298,0.329)$ & $0.028(0.021,0.036)$ & $0.539(0.522,0.558)$ \\\\\nLlama-3 & $0.264(0.250,0.280)$ & $0.021(0.015,0.027)$ & $0.500(0.482,0.518)$ \\\\\n \n\\end{tabular}\n\nTable 4: We compare six top-performing models across three metrics. Context bias is when the model chooses the context answer when its prior was correct. Prior bias is when the model chooses its prior when the context answer is correct. Finally, accuracy is a straightforward measure of the fraction of times it can produce the correct answer. We find that Claude Opus performs the best across all metrics with a context bias rate of 0.157 .",
        "page_idx": 10
    },
    {
        "text": "Model Accuracy and Biases\n\n\nFigure 5: We plot the data from Table 4 - each model's performance across three metrics in different colors, along with $95 \\%$ confidence intervals.",
        "page_idx": 11
    },
    {
        "text": "Figure 6: Effect of different prompts using GPT-4 on context preference rate vs prior probability. The \"Strict\" prompt strongly enforces literal adherence to the retrieved context, while the \"Loose\" prompt encourages the model to make a reasonable judgment in light of the provided context. We observe lower and steeper drops in context preference with the loose vs strict prompts, suggesting that prompt wording plays a significant factor in controlling context preference. Full prompts are provided in our GitHub repository.",
        "page_idx": 12
    }
]